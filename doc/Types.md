# Lilac data types

The Lilac script interpreter uses an extensible set of data types.  These data types are both used during Shastina script interpretation and also for passing data between different rendering nodes.

## Data type classes

There are three basic classes of data types:

1. Null class
2. Primitive class
3. Reference class

The _null class_ only contains a single data type, which is the `null` data type.  This `null` data type only has a single possible value, which is used to represent "no data."  The null class is not extensible.

The _primitive class_ contains data types that are passed around by fully copying their values.  Lilac primitives must fit within the C `double` floating-point data type with finite values only.  For integer types, this `double` data type is guaranteed to be able to exactly represent all integers in the following range:

    Minimum exact integer: -(2^53 - 1) = -9007199254740991
    Maximum exact integer:   2^53 - 1  =  9007199254740991

The _reference class_ contains data types that are passed around by reference.  They are not constrained to fit within a `double`.  However, they have the overhead of a separate memory allocation to store the actual data object.

## Data type names

Each Lilac data type must have a unique name.  The names have the format and follow the conventions given in the separate Lilac name identifiers documentation.

The special null data type has the name `null`.  All other data types defined by core or base plug-ins of Lilac are in the package `lilac` such as:

    lilac.float

The recommended convention is that the proper name (the last component of the hierarchical name identifier) begins with a lowercase letter if it is a primitive type or an uppercase letter if it is a reference type.  However, Lilac does not enforce this convention.

The namespace of Lilac data type names is separate from other Lilac namespaces.

## Type codes

Lilac internally uses unique integer codes to refer to specific data types.  The `type` module allows data type names to be registered and unique integer codes to be received.  It also allows the integer codes of registered data type strings to be queried.

The `null` data type always has an integer code of zero.  Primitive types are assigned unique integers greater than zero.  Reference types are assigned unique integers less than zero.

The actual type names are represented by `lilac.atom` types (see later).  The convention is that `null` maps to integer code zero, primitive types are one greater than the integer value of the type name atom, and reference types are one greater and then negated from the integer value of the type name atom.

Except for the mapping of `null` to zero, the mapping of data type names to numeric codes is not fixed and must be determined at runtime.

## Core types

The following are the data types defined by the Lilac core, which are necessary for core functionality.

    null

The null data type is in a data type class of its own and has only a single possible value, as discussed earlier.  It is used to indicate that no data is present.  It is the only core type that does not have a name in the `lilac` package.  The core script interpreter uses this type in the address space for ports that are not connected to anything.

    lilac.float

Represents a finite, floating-point value corresponding to the C `double` type.  This is guaranteed to support the exact integer range specified earlier.  The core script interpreter allows literal values of this type to be pushed on the stack using Shastina numeric entities that have either a `.` or `e` or `E` character somewhere within them.  This is a primitive type.

    lilac.int

Represents a signed, 32-bit integer value with the same range as a two's-complement 32-bit integer:  -2147483648 to 2147483647 inclusive.  This is a primitive type.

The core script interpreter allows literal values of this type to be pushed on the stack using Shastina numeric entities that have neither `.` nor `e` nor `E` anywhere within them.  The core script interpreter also uses this type for element counts generated by Shastina array entities.

The core parameter node defined at node address zero uses this type for ports representing current X and Y coordinates and the total width and height of layers.

    lilac.argb

Represents a packed, 32-bit ARGB value, where each channel has 8 bits.  The channels are in ARGB order, with A being the 8 most significant bits and B being the 8 least significant bits.  This is a primitive type.

The core script interpreter allows literal values of this type to be pushed on the stack using Shastina string entities with curly braces and no prefix.

This type is also used as the full-color port type for the core layer node defined at node address one.  Output layers may listen to ports of this type for full-color output.

There is no specific color system associated with this type, but it should generally be assumed to have non-linear channels and follow the sRGB standard unless specifically known to be otherwise.

    lilac.ch

Represents an 8-bit unsigned integer channel value, in range 0 to 255 inclusive.  It can also be used for 8-bit unsigned byte values, in which case `ch` could be considered as an abbreviation for _character_ rather than _channel._  This is a primitive type.

The core layer node uses this type as the compressed port type for the core layer node defined at node address one.  Output layers may listen to ports of this type for compressed output.  Specific compressors and decompressors are used to define exactly how 8-bit channel values correspond to 32-bit ARGB values stored in image files.  This is described in further detail in separate documentation about deep bitmaps.

    lilac.addr

Represents a packed, unsigned 32-bit address in the Lilac address space.  The 32 most significant bits are a node number and the 32 least significant bits are a port number.  The core Lilac system uses this type for identifying specific ports within the address space.  This is a primitive type.

    lilac.atom

Represents a unique integer code that is associated with a specific Lilac name identifier, which has a format described in the Lilac name identifiers documentation.  This is a primitive type.

The core layer allows values of this type to be pushed onto the interpreter stack using quoted string entities that have a `T` prefix.  The core layer checks that the format of the quoted string is a valid Lilac name identifier and then checks if it has already been registered as an atom.  If it has, the existing index of the atom is returned.  If it is not, the new atom is registered and the index of the atom is returned.

    lilac.String

Represents an ASCII string.  It must have a length in range zero to 16383 characters.  It is always nul terminated, which is not counted as part of the string length.  Characters within the string must be in range 0x20 to 0x7E inclusive, which is the visible, printing ASCII characters and space.  This is a reference type.

The core script interpreter allows literal values of this type to be pusehd on the stack using Shastina string entities with double quotes and no prefix.  Backslash is used as an escape character to allow for literal backslashes and literal double quotes within the string literal.

This type is also used for specifying image file paths for use with the core deep bitmap system.
